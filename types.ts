/**
 * Represents the two main sections of the Boys' Brigade.
 */
export type Section = 'company' | 'junior';

/**
 * Represents the squad numbers for the Company Section.
 */
export type Squad = 1 | 2 | 3;
/**
 * Represents the school year for members of the Company Section.
 */
export type SchoolYear = 8 | 9 | 10 | 11 | 12 | 13 | 14;

/**
 * Represents the squad numbers for the Junior Section.
 */
export type JuniorSquad = 1 | 2 | 3 | 4;
/**
 * Represents the school year (Primary school levels) for members of the Junior Section.
 */
export type JuniorYear = 'P4' | 'P5' | 'P6' | 'P7';

/**
 * Represents a single weekly mark entry for a member.
 * A score of -1 indicates absence.
 */
export interface Mark {
  /** The date of the meeting in 'YYYY-MM-DD' format. */
  date: string; 
  /** The total score for the night. -1 if absent. */
  score: number;
  /** (Junior Section only) The score for uniform inspection. */
  uniformScore?: number;
  /** (Junior Section only) The score for behaviour. */
  behaviourScore?: number;
}

/**
 * Represents a single member of the Boys' Brigade.
 */
export interface Boy {
  /** A unique identifier, generated by Firestore or a temporary one for offline creation. */
  id?: string;
  /** The full name of the member. */
  name: string;
  /** The squad number the member belongs to. */
  squad: Squad | JuniorSquad;
  /** The school year of the member. */
  year: SchoolYear | JuniorYear;
  /** An array of all recorded marks for the member. */
  marks: Mark[];
  /** A flag indicating if the member is a designated squad leader. */
  isSquadLeader?: boolean;
}

/**
 * Defines the types of actions that can be recorded in the audit log.
 */
export type AuditLogActionType = 
  'CREATE_BOY' | 
  'UPDATE_BOY' | 
  'DELETE_BOY' | 
  'REVERT_ACTION' | 
  'UPDATE_SETTINGS' | 
  'GENERATE_INVITE_CODE' | 
  'USE_INVITE_CODE' | 
  'REVOKE_INVITE_CODE' | 
  'UPDATE_INVITE_CODE' | // Added this type
  'UPDATE_USER_ROLE' |
  'DELETE_USER_ROLE' | // New: For deleting user roles
  'CLEAR_AUDIT_LOGS' | // New: For clearing all audit logs
  'CLEAR_USED_REVOKED_INVITE_CODES' | // New: For clearing used/revoked invite codes
  'CLEAR_LOCAL_DATA'; // New: For clearing all local data

/**
 * Represents a single entry in the audit log, tracking changes made in the application.
 */
export interface AuditLog {
  /** A unique identifier for the log entry. */
  id?: string;
  /** The timestamp of when the action occurred (Unix milliseconds). */
  timestamp: number;
  /** The email of the user who performed the action. */
  userEmail: string;
  /** The type of action performed. */
  actionType: AuditLogActionType;
  /** A human-readable description of the action. */
  description: string;
  /** Data needed to revert the action (e.g., the state of an object before a change). */
  revertData: any;
  /** The ID of the original audit log that this REVERT_ACTION log is reverting. */
  revertedLogId?: string;
  /** The section this log pertains to. Null for global logs. */
  section?: Section | null;
}

/**
 * Represents a one-time-use invite code for new user sign-ups.
 */
export interface InviteCode {
  /** The unique invite code string itself. */
  id: string;
  /** The email of the user who generated this code. */
  generatedBy: string;
  /** The timestamp when the code was generated (Unix milliseconds). */
  generatedAt: number;
  /** The section this code is intended for (optional, could be 'all' or specific). */
  section?: Section;
  /** True if the code has been used, false otherwise. */
  isUsed: boolean;
  /** The email of the user who used this code (if used). */
  usedBy?: string;
  /** The timestamp when the code was used (if used). */
  usedAt?: number;
  /** True if the code has been explicitly revoked, false otherwise. */
  revoked?: boolean;
  /** The default role assigned to the user who uses this invite code. */
  defaultUserRole: UserRole;
  /** The timestamp when the code expires (Unix milliseconds). */
  expiresAt: number;
}

/**
 * Represents the main pages available in the application's navigation.
 */
export type Page = 'home' | 'weeklyMarks' | 'dashboard' | 'auditLog' | 'settings' | 'globalSettings' | 'accountSettings' | 'signup';

/**
 * A specific view type for displaying an individual boy's marks page.
 * Includes the boy's ID to fetch the correct data.
 */
export interface BoyMarksPageView {
  page: 'boyMarks';
  boyId: string;
}

/**
 * A union type representing the current view of the application,
 * which can be a standard page or a more specific view like BoyMarksPageView.
 */
export type View = { page: Page } | BoyMarksPageView;

/**
 * Represents the settings specific to a section (Company or Junior).
 */
export interface SectionSettings {
  /** The day of the week the section meets (0 = Sunday, 1 = Monday, ..., 6 = Saturday). */
  meetingDay: number;
}

/**
 * Defines the types of toast notifications.
 */
export type ToastType = 'success' | 'error' | 'info';

/**
 * Represents a single toast notification message.
 */
export interface ToastMessage {
  id: string;
  message: string;
  type: ToastType;
}

/**
 * Defines the available sorting options for the member roster.
 */
export type SortByType = 'name' | 'marks' | 'attendance';

/**
 * Defines the possible roles a user can have in the application.
 */
export type UserRole = 'admin' | 'captain' | 'officer';

// Import the User type from firebase/auth to extend it correctly
import { User } from 'firebase/auth';

/**
 * Extends the Firebase User type to include the custom role.
 */
export interface UserWithRole extends User {
  role: UserRole | null;
}