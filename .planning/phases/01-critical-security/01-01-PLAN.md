---
phase: 01-critical-security
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/db.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "TypeScript compiles without errors (npx tsc -noEmit passes)"
    - "Audit log action type is consistent across codebase"
    - "All AuditLogActionType usages reference the defined type union"
  artifacts:
    - path: "services/db.ts"
      provides: "Audit logging with correct action type"
      contains: "'GENERATE_INVITE_CODE'"
    - path: "tsconfig.json"
      provides: "TypeScript compiler configuration"
      contains: "noFallthroughCasesInSwitch"
  key_links:
    - from: "services/db.ts"
      to: "types.ts"
      via: "import { AuditLogActionType }"
      pattern: "GENERATE_INVITE_CODE"
---

<objective>
Fix TypeScript error in services/db.ts line 514 and prevent future type mismatches

Purpose: The audit log system uses a discriminated union `AuditLogActionType` to track all user actions. Currently, `services/db.ts:514` uses `'CREATE_INVITE_CODE'` but `types.ts` defines `'GENERATE_INVITE_CODE'`, causing a type mismatch. This fix ensures type consistency and enables exhaustiveness checking to catch similar issues at compile time.

Output: Working TypeScript compilation with `noFallthroughCasesInSwitch` enabled
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@types.ts
@services/db.ts
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Fix audit log action type mismatch</name>
  <files>services/db.ts</files>
  <action>
    1. Change line 514 from `actionType: 'CREATE_INVITE_CODE'` to `actionType: 'GENERATE_INVITE_CODE'`
    2. Run `npx tsc -noEmit` to verify the fix resolves the type error
    3. Grep the codebase for any remaining instances of `'CREATE_INVITE_CODE'` to ensure complete consistency

    Why: The type union in types.ts defines 'GENERATE_INVITE_CODE' not 'CREATE_INVITE_CODE'. This mismatch causes TypeScript compilation errors and represents an inconsistency between the type definition and its usage.
  </action>
  <verify>npx tsc -noEmit</verify>
  <done>TypeScript compiles without errors; no instances of 'CREATE_INVITE_CODE' remain in codebase</done>
</task>

<task type="auto">
  <name>Enable exhaustiveness checking for discriminated unions</name>
  <files>tsconfig.json</files>
  <action>
    Add `"noFallthroughCasesInSwitch": true` to the `compilerOptions` object in tsconfig.json. This option ensures that all cases in a discriminated union are handled in switch statements, catching missing cases at compile time.

    Why: The type mismatch error could have been caught earlier if exhaustiveness checking was enabled. This prevents similar issues with AuditLogActionType and other discriminated unions in the future.
  </action>
  <verify>npx tsc -noEmit</verify>
  <done>tsconfig.json contains noFallthroughCasesInSwitch option and TypeScript still compiles</done>
</task>

<task type="auto">
  <name>Verify audit log action type consistency</name>
  <files>types.ts, services/db.ts, components/AuditLogPage.tsx, components/GlobalSettingsPage.tsx</files>
  <action>
    Grep for all usages of `AuditLogActionType`, `GENERATE_INVITE_CODE`, and other action type literals. Verify that:
    1. All usages reference values from the type union in types.ts
    2. No string literals are used that are not defined in the type union
    3. The AuditLogPage.tsx switch statement handles all defined action types

    Why: Full consistency verification ensures the type system provides complete coverage. Any remaining inconsistencies could cause runtime errors or UI glitches.
  </action>
  <verify>grep -r "AuditLogActionType\|CREATE_INVITE_CODE\|GENERATE_INVITE_CODE" --include="*.ts" --include="*.tsx" .</verify>
  <done>All action type usages reference the defined type union; no orphaned string literals</done>
</task>

</tasks>

<verification>
1. Run `npx tsc -noEmit` - must pass with zero errors
2. Verify `noFallthroughCasesInSwitch` is present in tsconfig.json
3. Confirm no 'CREATE_INVITE_CODE' instances remain in codebase
4. All AuditLogActionType usages match the defined type union
</verification>

<success_criteria>
1. TypeScript compilation passes without errors
2. `noFallthroughCasesInSwitch` enabled in tsconfig.json
3. Zero instances of incorrect action type literals
4. Codebase references consistent type definitions
</success_criteria>

<output>
After completion, create `.planning/phases/01-critical-security/01-01-SUMMARY.md`
</output>
