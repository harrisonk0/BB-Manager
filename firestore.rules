rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read/write access to any document only if the user is signed in.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Specific rules for invite_codes collection
    match /invite_codes/{codeId} {
      // Allow authenticated users to create invite codes
      allow create: if request.auth != null;

      // Allow unauthenticated users to read an invite code (to validate it)
      // and update it (to mark as used) only if they are simultaneously creating a new user.
      // This rule is more permissive for unauthenticated writes than typical,
      // but necessary for the invite code signup flow.
      allow get, update: if true; // This allows anyone to read/update. We'll rely on client-side logic for security.
                                  // For a truly robust solution, this would require a Cloud Function to verify
                                  // the invite code and create the user, then mark the code as used.
                                  // Given the constraint of no Cloud Functions, this is the simplest approach.
    }
  }
}